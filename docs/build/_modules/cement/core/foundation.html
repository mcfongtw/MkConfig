<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cement.core.foundation &#8212; MkConfig 0.1-alpha documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MkConfig 0.1-alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cement.core.foundation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Cement core foundation module.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="k">import</span> <span class="n">backend</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">plugin</span>
<span class="kn">from</span> <span class="nn">..core</span> <span class="k">import</span> <span class="n">output</span><span class="p">,</span> <span class="n">extension</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">..core.handler</span> <span class="k">import</span> <span class="n">HandlerManager</span>
<span class="kn">from</span> <span class="nn">..core.hook</span> <span class="k">import</span> <span class="n">HookManager</span>
<span class="kn">from</span> <span class="nn">..utils.misc</span> <span class="k">import</span> <span class="n">is_true</span><span class="p">,</span> <span class="n">minimal_logger</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="k">import</span> <span class="n">fs</span>

<span class="c1"># The `imp` module is deprecated in favor of `importlib` in 3.4, but it</span>
<span class="c1"># wasn&#39;t introduced until 3.1.  Finally, reload is a builtin on Python &lt; 3</span>
<span class="n">pyver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span>
<span class="k">if</span> <span class="n">pyver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">pyver</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>                <span class="c1"># pragma: nocover  # noqa</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">reload</span> <span class="k">as</span> <span class="n">reload_module</span>  <span class="c1"># pragma: nocover  # noqa</span>
<span class="k">elif</span> <span class="n">pyver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>                                <span class="c1"># pragma: nocover  # noqa</span>
    <span class="kn">from</span> <span class="nn">imp</span> <span class="k">import</span> <span class="n">reload</span> <span class="k">as</span> <span class="n">reload_module</span>        <span class="c1"># pragma: nocover  # noqa</span>
<span class="k">else</span><span class="p">:</span>                                              <span class="c1"># pragma: nocover  # noqa</span>
    <span class="n">reload_module</span> <span class="o">=</span> <span class="n">reload</span>                         <span class="c1"># pragma: nocover  # noqa</span>


<span class="n">LOG</span> <span class="o">=</span> <span class="n">minimal_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
    <span class="n">SIGNALS</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">]</span>   <span class="c1"># pragma: nocover</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">SIGNALS</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGHUP</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">add_handler_override_options</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a ``post_setup`` hook that adds the handler override options to</span>
<span class="sd">    the argument parser</span>

<span class="sd">    :param app: The application object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">list_types</span><span class="p">():</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;interface &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span>
                      <span class="s2">&quot; is not defined, can not override handlers&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">())</span>

            <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>
                       <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">handlers</span>
                       <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">overridable</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">]</span>

            <span class="c1"># don&#39;t display the option if no handlers are overridable</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no handlers are overridable within the &quot;</span> <span class="o">+</span>
                          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> interface&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># override things that we need to control</span>
            <span class="n">argument_kw</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">argument_kw</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_handler_override&#39;</span> <span class="o">%</span> <span class="n">i</span>
            <span class="n">argument_kw</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;store&#39;</span>
            <span class="n">argument_kw</span><span class="p">[</span><span class="s1">&#39;choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choices</span>

            <span class="n">app</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="o">*</span><span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="o">**</span><span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>


<span class="k">def</span> <span class="nf">handler_override</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a ``post_argument_parsing`` hook that overrides a configured</span>
<span class="sd">    handler if defined in ``CementApp.Meta.handler_override_options`` and</span>
<span class="sd">    the option is passed at command line with a valid handler label.</span>

<span class="sd">    :param app: The application object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">pargs</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_handler_override&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">pargs</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_handler_override&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get the argument value from command line</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">pargs</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_handler_override&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_handler&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span>

            <span class="c1"># and then re-setup the handler</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;_setup_</span><span class="si">%s</span><span class="s1">_handler&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)()</span>


<span class="k">def</span> <span class="nf">cement_signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Catch a signal, run the &#39;signal&#39; hook, and then raise an exception</span>
<span class="sd">    allowing the app to handle logic elsewhere.</span>

<span class="sd">    :param signum: The signal number</span>
<span class="sd">    :param frame: The signal frame.</span>
<span class="sd">    :raises: cement.core.exc.CaughtSignal</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Caught signal </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">signum</span><span class="p">)</span>

    <span class="c1"># FIXME: Maybe this isn&#39;t ideal... purhaps make</span>
    <span class="c1"># CementApp.Meta.signal_handler a decorator that take the app object</span>
    <span class="c1"># and wraps/returns the actually signal handler?</span>
    <span class="k">for</span> <span class="n">f_global</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_global</span><span class="p">,</span> <span class="n">CementApp</span><span class="p">):</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">f_global</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
                <span class="k">pass</span>  <span class="c1"># pragma: nocover</span>
    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">CaughtSignal</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CementApp</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">MetaMixin</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The primary class to build applications from.</span>

<span class="sd">    Usage:</span>

<span class="sd">    The following is the simplest CementApp:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from cement.core.foundation import CementApp</span>

<span class="sd">        with CementApp(&#39;helloworld&#39;) as app:</span>
<span class="sd">            app.run()</span>


<span class="sd">    Alternatively, the above could be written as:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from cement.core.foundation import CementApp</span>

<span class="sd">        app = foundation.CementApp(&#39;helloworld&#39;)</span>
<span class="sd">        app.setup()</span>
<span class="sd">        app.run()</span>
<span class="sd">        app.close()</span>


<span class="sd">    A more advanced example looks like:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from cement.core.foundation import CementApp</span>
<span class="sd">        from cement.core.controller import CementBaseController, expose</span>

<span class="sd">        class MyController(CementBaseController):</span>
<span class="sd">            class Meta:</span>
<span class="sd">                label = &#39;base&#39;</span>
<span class="sd">                arguments = [</span>
<span class="sd">                    ( [&#39;-f&#39;, &#39;--foo&#39;], dict(help=&#39;Notorious foo option&#39;) ),</span>
<span class="sd">                    ]</span>
<span class="sd">                config_defaults = dict(</span>
<span class="sd">                    debug=False,</span>
<span class="sd">                    some_config_param=&#39;some_value&#39;,</span>
<span class="sd">                    )</span>

<span class="sd">            @expose(help=&#39;This is the default command&#39;, hide=True)</span>
<span class="sd">            def default(self):</span>
<span class="sd">                print(&#39;Hello World&#39;)</span>

<span class="sd">        class MyApp(CementApp):</span>
<span class="sd">            class Meta:</span>
<span class="sd">                label = &#39;helloworld&#39;</span>
<span class="sd">                extensions = [&#39;daemon&#39;,&#39;json&#39;,]</span>
<span class="sd">                base_controller = MyController</span>

<span class="sd">        with MyApp() as app:</span>
<span class="sd">            app.run()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Application meta-data (can also be passed as keyword arguments to the</span>
<span class="sd">        parent class).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the application.  This should be the common name as you</span>
<span class="sd">        would see and use at the command line.  For example &#39;helloworld&#39;, or</span>
<span class="sd">        &#39;my-awesome-app&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used internally, and should not be used by developers.  This is set</span>
<span class="sd">        to `True` if `--debug` is passed at command line.&quot;&quot;&quot;</span>

        <span class="n">exit_on_close</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not to call ``sys.exit()`` when ``close()`` is called.</span>
<span class="sd">        The default is ``False``, however if ``True`` then the app will call</span>
<span class="sd">        ``sys.exit(X)`` where ``X`` is ``self.exit_code``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_extension</span> <span class="o">=</span> <span class="s1">&#39;.conf&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extension used to identify application and plugin configuration files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_files</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of config files to parse.</span>

<span class="sd">        Note: Though Meta.config_section defaults to None, Cement will</span>
<span class="sd">        set this to a default list based on Meta.label (or in other words,</span>
<span class="sd">        the name of the application).  This will equate to:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [&#39;/etc/&lt;app_label&gt;/&lt;app_label&gt;.conf&#39;,</span>
<span class="sd">             &#39;~/.&lt;app_label&gt;.conf&#39;,</span>
<span class="sd">             &#39;~/.&lt;app_label&gt;/config&#39;]</span>


<span class="sd">        Files are loaded in order, and have precedence in order.  Therefore,</span>
<span class="sd">        the last configuration loaded has precedence (and overwrites settings</span>
<span class="sd">        loaded from previous configuration files).</span>

<span class="sd">        Note that ``.conf`` is the default config file extension, defined by</span>
<span class="sd">        ``CementApp.Meta.config_extension``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of plugins to load.  This is generally considered bad</span>
<span class="sd">        practice since plugins should be dynamically enabled/disabled</span>
<span class="sd">        via a plugin config file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_config_dirs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of directory paths where plugin config files can be found.</span>
<span class="sd">        Files must end in ``.conf`` (or the extension defined by</span>
<span class="sd">        ``CementApp.Meta.config_extension``) or they will be ignored.</span>

<span class="sd">        Note: Though ``CementApp.Meta.plugin_config_dirs`` is ``None``, Cement</span>
<span class="sd">        will set this to a default list based on ``CementApp.Meta.label``.</span>
<span class="sd">        This will equate to:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [&#39;/etc/&lt;app_label&gt;/plugins.d&#39;, &#39;~/.&lt;app_label&gt;/plugin.d&#39;]</span>


<span class="sd">        Files are loaded in order, and have precedence in that order.</span>
<span class="sd">        Therefore, the last configuration loaded has precedence (and</span>
<span class="sd">        overwrites settings loaded from previous configuration files).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_config_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A directory path where plugin config files can be found.  Files must</span>
<span class="sd">        end in ``.conf`` (or the extension defined by</span>
<span class="sd">        ``CementApp.Meta.config_extension``) or they will be ignored.  By</span>
<span class="sd">        default, this setting is also overridden by the</span>
<span class="sd">        ``[&lt;app_label&gt;] -&gt; plugin_config_dir`` config setting parsed in</span>
<span class="sd">        any of the application configuration files.</span>

<span class="sd">        If set, this item will be **appended** to</span>
<span class="sd">        ``CementApp.Meta.plugin_config_dirs`` so that it&#39;s settings will have</span>
<span class="sd">        presedence over other configuration files.</span>

<span class="sd">        In general, this setting should not be defined by the developer, as it</span>
<span class="sd">        is primarily used to allow the end-user to define a</span>
<span class="sd">        ``plugin_config_dir`` without completely trumping the hard-coded list</span>
<span class="sd">        of default ``plugin_config_dirs`` defined by the app/developer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_bootstrap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A python package (dotted import path) where plugin code can be</span>
<span class="sd">        loaded from.  This is generally something like ``myapp.plugins``</span>
<span class="sd">        where a plugin file would live at ``myapp/plugins/myplugin.py``.</span>
<span class="sd">        This provides a facility for applications that have builtin plugins</span>
<span class="sd">        that ship with the applications source code and live in the same</span>
<span class="sd">        Python module.</span>

<span class="sd">        Note: Though the meta default is ``None``, Cement will set this to</span>
<span class="sd">        ``&lt;app_label&gt;.plugins`` if not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_dirs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of directory paths where plugin code (modules) can be loaded</span>
<span class="sd">        from.</span>

<span class="sd">        Note: Though ``CementApp.Meta.plugin_dirs`` is None, Cement will set</span>
<span class="sd">        this to a default list based on ``CementApp.Meta.label`` if not set.</span>
<span class="sd">        This will equate to:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [&#39;~/.&lt;app_label&gt;/plugins&#39;, &#39;/usr/lib/&lt;app_label&gt;/plugins&#39;]</span>


<span class="sd">        Modules are attempted to be loaded in order, and will stop loading</span>
<span class="sd">        once a plugin is successfully loaded from a directory.  Therefore</span>
<span class="sd">        this is the oposite of configuration file loading, in that here the</span>
<span class="sd">        first has precedence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A directory path where plugin code (modules) can be loaded from.</span>
<span class="sd">        By default, this setting is also overridden by the</span>
<span class="sd">        ``[&lt;app_label&gt;] -&gt; plugin_dir`` config setting parsed in any of the</span>
<span class="sd">        application configuration files.</span>

<span class="sd">        If set, this item will be **prepended** to ``Meta.plugin_dirs`` so</span>
<span class="sd">        that a users defined ``plugin_dir`` has precedence over others.</span>

<span class="sd">        In general, this setting should not be defined by the developer, as it</span>
<span class="sd">        is primarily used to allow the end-user to define a</span>
<span class="sd">        ``plugin_dir`` without completely trumping the hard-coded list</span>
<span class="sd">        of default ``plugin_dirs`` defined by the app/developer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">argv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of arguments to use for parsing command line arguments</span>
<span class="sd">        and options.</span>

<span class="sd">        Note: Though Meta.argv defaults to None, Cement will set this to</span>
<span class="sd">        ``list(sys.argv[1:])`` if no argv is set in Meta during setup().</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">arguments_override_config</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A boolean to toggle whether command line arguments should</span>
<span class="sd">        override configuration values if the argument name matches the</span>
<span class="sd">        config key.  I.e. --foo=bar would override config[&#39;myapp&#39;][&#39;foo&#39;].</span>

<span class="sd">        This is different from ``override_arguments`` in that if</span>
<span class="sd">        ``arguments_override_config`` is ``True``, then all arguments will</span>
<span class="sd">        override (you don&#39;t have to list them all).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">override_arguments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of arguments that override their configuration counter-part.</span>
<span class="sd">        For example, if ``--debug`` is passed (and it&#39;s config value is</span>
<span class="sd">        ``debug``) then the ``debug`` key of all configuration sections will</span>
<span class="sd">        be overridden by the value of the command line option (``True`` in</span>
<span class="sd">        this example).</span>

<span class="sd">        This is different from ``arguments_override_config`` in that this is</span>
<span class="sd">        a selective list of specific arguments to override the config with</span>
<span class="sd">        (and not all arguments that match the config).  This list will take</span>
<span class="sd">        affect whether ``arguments_override_config`` is ``True`` or ``False``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">core_handler_override_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">output</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;-o&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;output handler&#39;</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to ``CementApp.Meta.handler_override_options`` but these are</span>
<span class="sd">        the core defaults required by Cement.  This dictionary can be</span>
<span class="sd">        overridden by ``CementApp.Meta.handler_override_options`` (when they</span>
<span class="sd">        are merged together).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">handler_override_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of handler override options that will be added to the</span>
<span class="sd">        argument parser, and allow the end-user to override handlers.  Useful</span>
<span class="sd">        for interfaces that have multiple uses within the same application</span>
<span class="sd">        (for example: Output Handler (json, yaml, etc) or maybe a Cloud</span>
<span class="sd">        Provider Handler (rackspace, digitalocean, amazon, etc).</span>

<span class="sd">        This dictionary will merge with</span>
<span class="sd">        ``CementApp.Meta.core_handler_override_options`` but this one has</span>
<span class="sd">        precedence.</span>

<span class="sd">        Dictionary Format:</span>

<span class="sd">        .. code-block:: text</span>

<span class="sd">            &lt;interface_name&gt; = (option_arguments, help_text)</span>


<span class="sd">        See ``CementApp.Meta.core_handler_override_options`` for an example</span>
<span class="sd">        of what this should look like.</span>

<span class="sd">        Note, if set to ``None`` then no options will be defined, and the</span>
<span class="sd">        ``CementApp.Meta.core_meta_override_options`` will be ignore (not</span>
<span class="sd">        recommended as some extensions rely on this feature).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_section</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The base configuration section for the application.</span>

<span class="sd">        Note: Though Meta.config_section defaults to None, Cement will</span>
<span class="sd">        set this to the value of Meta.label (or in other words, the name</span>
<span class="sd">        of the application).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_defaults</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;Default configuration dictionary.  Must be of type &#39;dict&#39;.&quot;&quot;&quot;</span>

        <span class="n">meta_defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default metadata dictionary used to pass high level options from the</span>
<span class="sd">        application down to handlers at the point they are registered by the</span>
<span class="sd">        framework **if the handler has not already been instantiated**.</span>

<span class="sd">        For example, if requiring the ``json`` extension, you might want to</span>
<span class="sd">        override ``JsonOutputHandler.Meta.json_module`` with ``ujson`` by</span>
<span class="sd">        doing the following</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from cement.core.foundation import CementApp</span>
<span class="sd">            from cement.utils.misc import init_defaults</span>

<span class="sd">            META = init_defaults(&#39;output.json&#39;)</span>
<span class="sd">            META[&#39;output.json&#39;][&#39;json_module&#39;] = &#39;ujson&#39;</span>

<span class="sd">            class MyApp(CementApp):</span>
<span class="sd">                class Meta:</span>
<span class="sd">                    label = &#39;myapp&#39;</span>
<span class="sd">                    extensions = [&#39;json&#39;]</span>
<span class="sd">                    meta_defaults = META</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">catch_signals</span> <span class="o">=</span> <span class="n">SIGNALS</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of signals to catch, and raise exc.CaughtSignal for.</span>
<span class="sd">        Can be set to None to disable signal handling.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">signal_handler</span> <span class="o">=</span> <span class="n">cement_signal_handler</span>
        <span class="sd">&quot;&quot;&quot;A function that is called to handle any caught signals.&quot;&quot;&quot;</span>

        <span class="n">config_handler</span> <span class="o">=</span> <span class="s1">&#39;configparser&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IConfig interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mail_handler</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IMail interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">extension_handler</span> <span class="o">=</span> <span class="s1">&#39;cement&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IExtension interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">log_handler</span> <span class="o">=</span> <span class="s1">&#39;logging&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the ILog interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plugin_handler</span> <span class="o">=</span> <span class="s1">&#39;cement&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IPlugin interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">argument_handler</span> <span class="o">=</span> <span class="s1">&#39;argparse&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IArgument interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_handler</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the IOutput interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cache_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A handler class that implements the ICache interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">base_controller</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the base application controller.  If a controller is set,</span>
<span class="sd">        runtime operations are passed to the controller for command</span>
<span class="sd">        dispatch and argument parsing when CementApp.run() is called.</span>

<span class="sd">        Note that cement will automatically set the `base_controller` to a</span>
<span class="sd">        registered controller whose label is &#39;base&#39; (only if `base_controller`</span>
<span class="sd">        is not currently set).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;List of additional framework extensions to load.&quot;&quot;&quot;</span>

        <span class="n">bootstrap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A bootstrapping module to load after app creation, and before</span>
<span class="sd">        app.setup() is called.  This is useful for larger applications</span>
<span class="sd">        that need to offload their bootstrapping code such as registering</span>
<span class="sd">        hooks/handlers/etc to another file.</span>

<span class="sd">        This must be a dotted python module path.</span>
<span class="sd">        I.e. &#39;myapp.bootstrap&#39; (myapp/bootstrap.py).  Cement will then</span>
<span class="sd">        import the module, and if the module has a &#39;load()&#39; function, that</span>
<span class="sd">        will also be called.  Essentially, this is the same as an</span>
<span class="sd">        extension or plugin, but as a facility for the application itself</span>
<span class="sd">        to bootstrap &#39;hardcoded&#39; application code.  It is also called</span>
<span class="sd">        before plugins are loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">core_extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;cement.ext.ext_dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cement.ext.ext_smtp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cement.ext.ext_plugin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cement.ext.ext_configparser&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cement.ext.ext_logging&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cement.ext.ext_argparse&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of Cement core extensions.  These are generally required by</span>
<span class="sd">        Cement and should only be modified if you know what you&#39;re</span>
<span class="sd">        doing.  Use &#39;extensions&#39; to add to this list, rather than</span>
<span class="sd">        overriding core extensions.  That said if you want to prune down</span>
<span class="sd">        your application, you can remove core extensions if they are</span>
<span class="sd">        not necessary (for example if using your own log handler</span>
<span class="sd">        extension you likely don&#39;t want/need LoggingLogHandler to be</span>
<span class="sd">        registered).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">core_meta_override</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
            <span class="s1">&#39;plugin_config_dir&#39;</span><span class="p">,</span>
            <span class="s1">&#39;plugin_dir&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ignore_deprecation_warnings&#39;</span><span class="p">,</span>
            <span class="s1">&#39;template_dir&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mail_handler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cache_handler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;log_handler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;output_handler&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of meta options that can/will be overridden by config options</span>
<span class="sd">        of the &#39;[base]&#39; config section (where [base] is the base</span>
<span class="sd">        configuration section of the application which is determined by</span>
<span class="sd">        Meta.config_section but defaults to Meta.label). These overrides</span>
<span class="sd">        are required by the framework to function properly and should not</span>
<span class="sd">        be used by end user (developers) unless you really know what</span>
<span class="sd">        you&#39;re doing.  To add your own extended meta overrides please use</span>
<span class="sd">        &#39;meta_override&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meta_override</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of meta options that can/will be overridden by config options</span>
<span class="sd">        of the &#39;[base]&#39; config section (where [base] is the</span>
<span class="sd">        base configuration section of the application which is determined</span>
<span class="sd">        by Meta.config_section but defaults to Meta.label).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ignore_deprecation_warnings</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;Disable deprecation warnings from being logged by Cement.&quot;&quot;&quot;</span>

        <span class="n">template_module</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A python package (dotted import path) where template files can be</span>
<span class="sd">        loaded from.  This is generally something like ``myapp.templates``</span>
<span class="sd">        where a plugin file would live at ``myapp/templates/mytemplate.txt``.</span>
<span class="sd">        Templates are first loaded from ``CementApp.Meta.template_dirs``, and</span>
<span class="sd">        and secondly from ``CementApp.Meta.template_module``.  The</span>
<span class="sd">        ``template_dirs`` setting has presedence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_dirs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A list of directory paths where template files can be loaded</span>
<span class="sd">        from.</span>

<span class="sd">        Note: Though ``CementApp.Meta.template_dirs`` defaults to ``None``,</span>
<span class="sd">        Cement will set this to a default list based on</span>
<span class="sd">        ``CementApp.Meta.label``.  This will equate to:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [&#39;~/.&lt;app_label&gt;/templates&#39;, &#39;/usr/lib/&lt;app_label&gt;/templates&#39;]</span>


<span class="sd">        Templates are attempted to be loaded in order, and will stop loading</span>
<span class="sd">        once a template is successfully loaded from a directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A directory path where template files can be loaded from.  By default,</span>
<span class="sd">        this setting is also overridden by the</span>
<span class="sd">        ``[&lt;app_label&gt;] -&gt; template_dir`` config setting parsed in any of the</span>
<span class="sd">        application configuration files .</span>

<span class="sd">        If set, this item will be **prepended** to</span>
<span class="sd">        ``CementApp.Meta.template_dirs`` (giving it precedence over other</span>
<span class="sd">        ``template_dirs``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">framework_logging</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not to enable Cement framework logging.  This is separate</span>
<span class="sd">        from the application log, and is generally used for debugging issues</span>
<span class="sd">        with the framework and/or extensions primarily in development.</span>

<span class="sd">        This option is overridden by the environment variable</span>
<span class="sd">        `CEMENT_FRAMEWORK_LOGGING`.  Therefore, if in production you do not</span>
<span class="sd">        want the Cement framework log enabled, you can set this option to</span>
<span class="sd">        ``False`` but override it in your environment by doing something like</span>
<span class="sd">        ``export CEMENT_FRAMEWORK_LOGGING=1`` in your shell whenever you need</span>
<span class="sd">        it enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">define_hooks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of hook definitions (label).  Will be passed to</span>
<span class="sd">        ``self.hook.define(&lt;hook_label&gt;)``.  Must be a list of strings.</span>

<span class="sd">        I.e. ``[&#39;my_custom_hook&#39;, &#39;some_other_hook&#39;]``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hooks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of hooks to register when the app is created.  Will be passed to</span>
<span class="sd">        ``self.hook.register(&lt;hook_label&gt;, &lt;hook_func&gt;)``.  Must be a list of</span>
<span class="sd">        tuples in the form of ``(&lt;hook_label&gt;, &lt;hook_func&gt;)``.</span>

<span class="sd">        I.e. ``[(&#39;post_argument_parsing&#39;, my_hook_func)]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">define_handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of interfaces classes to define handlers.  Must be a list of</span>
<span class="sd">        uninstantiated interface classes.</span>

<span class="sd">        I.e. ``[&#39;MyCustomInterface&#39;, &#39;SomeOtherInterface&#39;]``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of handler classes to register.  Will be passed to</span>
<span class="sd">        ``handler.register(&lt;handler_class&gt;)``.  Must be a list of</span>
<span class="sd">        uninstantiated handler classes.</span>

<span class="sd">        I.e. ``[MyCustomHandler, SomeOtherHandler]``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">use_backend_globals</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a backward compatibility feature.  Cement 2.x.x</span>
<span class="sd">        relies on several global variables hidden in ``cement.core.backend``</span>
<span class="sd">        used for things like storing hooks and handlers.  Future versions of</span>
<span class="sd">        Cement will no longer use this mechanism, however in order to maintain</span>
<span class="sd">        backward compatibility this is still the default.  By disabling this</span>
<span class="sd">        feature allows multiple instances of CementApp to be created</span>
<span class="sd">        from within the same runtime space without clobbering eachothers</span>
<span class="sd">        hooks/handers/etc.</span>

<span class="sd">        Be warned that use of third-party extensions might break as they were</span>
<span class="sd">        built using backend globals, and probably have no idea this feature</span>
<span class="sd">        has changed or exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">alternative_module_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        EXPERIMENTAL FEATURE: This is an experimental feature added in Cement</span>
<span class="sd">        2.9.x and may or may not be removed in future versions of Cement.</span>

<span class="sd">        Dictionary of alternative, **drop-in** replacement modules to use</span>
<span class="sd">        selectively throughout the application, framework, or</span>
<span class="sd">        extensions.  Developers can optionally use the</span>
<span class="sd">        ``CementApp.__import__()`` method to import simple modules, and if</span>
<span class="sd">        that module exists in this mapping it will import the alternative</span>
<span class="sd">        library in it&#39;s place.</span>

<span class="sd">        This is a low-level feature, and may not produce the results you are</span>
<span class="sd">        expecting.  It&#39;s purpose is to allow the developer to replace specific</span>
<span class="sd">        modules at a high level.  Example: For an application wanting to use</span>
<span class="sd">        ``ujson`` in place of ``json``, the developer could set the following:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            alternative_module_mapping = {</span>
<span class="sd">                &#39;json&#39; : &#39;ujson&#39;,</span>
<span class="sd">            }</span>

<span class="sd">        In the app, you would then load ``json`` as:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            _json = app.__import__(&#39;json&#39;)</span>
<span class="sd">            _json.dumps(data)</span>


<span class="sd">        Obviously, the replacement module **must be** a drop-in replace and</span>
<span class="sd">        function the same.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CementApp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="c1"># disable framework logging?</span>
        <span class="k">if</span> <span class="s1">&#39;CEMENT_FRAMEWORK_LOGGING&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">framework_logging</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CEMENT_FRAMEWORK_LOGGING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CEMENT_FRAMEWORK_LOGGING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>

        <span class="c1"># for convenience we translate this to _meta</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_label</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bootstrap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_rendered</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extended_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stdout__</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stderr__</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__retry_hooks__</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># setup argv... this has to happen before lay_cement()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="c1"># hack for command line --debug</span>
        <span class="k">if</span> <span class="s1">&#39;--debug&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># setup the cement framework</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lay_cement</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns boolean based on whether ``--debug`` was passed at command</span>
<span class="sd">        line or set via the application&#39;s configuration file.</span>

<span class="sd">        :returns: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">debug</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">argv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The arguments list that will be used when self.run() is called.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argv</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">member_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend the CementApp() object with additional functions/classes such</span>
<span class="sd">        as &#39;app.my_custom_function()&#39;, etc.  It provides an interface for</span>
<span class="sd">        extensions to provide functionality that travel along with the</span>
<span class="sd">        application object.</span>

<span class="sd">        :param member_name: The name to attach the object to.</span>
<span class="sd">        :type member_name: ``str``</span>
<span class="sd">        :param member_object: The function or class object to attach to</span>
<span class="sd">            CementApp().</span>
<span class="sd">        :raises: cement.core.exc.FrameworkError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">FrameworkError</span><span class="p">(</span><span class="s2">&quot;App member &#39;</span><span class="si">%s</span><span class="s2">&#39; already exists!&quot;</span> <span class="o">%</span>
                                     <span class="n">member_name</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;extending appication with &#39;.</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">member_name</span><span class="p">,</span> <span class="n">member_object</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_name</span><span class="p">,</span> <span class="n">member_object</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">member_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extended_members</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extended_members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">FrameworkError</span><span class="p">(</span><span class="s2">&quot;Application name missing.&quot;</span><span class="p">)</span>

        <span class="c1"># validate the name is ok</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">char</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">FrameworkError</span><span class="p">(</span>
                    <span class="s2">&quot;App label can only contain alpha-numeric, dashes, &quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;or underscores.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function wraps all &#39;_setup&#39; actons in one call.  It is called</span>
<span class="sd">        before self.run(), allowing the application to be _setup but not</span>
<span class="sd">        executed (possibly letting the developer perform other actions</span>
<span class="sd">        before full execution.).</span>

<span class="sd">        All handlers should be instantiated and callable after setup is</span>
<span class="sd">        complete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;now setting up the &#39;</span><span class="si">%s</span><span class="s2">&#39; application&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;importing bootstrap code from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span> \
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bootstrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">],</span> <span class="s1">&#39;load&#39;</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bootstrap</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reload_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bootstrap</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pre_setup&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_extension_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_signals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_config_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_mail_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_cache_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_log_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_plugin_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_arg_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_output_handler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_controllers</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">hook_spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__retry_hooks__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="o">*</span><span class="n">hook_spec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;post_setup&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function wraps everything together (after self._setup() is</span>
<span class="sd">        called) to run the application.</span>

<span class="sd">        :returns: Returns the result of the executed controller function if</span>
<span class="sd">          a base controller is set and a controller function is called,</span>
<span class="sd">          otherwise ``None`` if no controller dispatched or no controller</span>
<span class="sd">          function was called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">return_val</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;running pre_run hook&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pre_run&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="c1"># If controller exists, then dispatch it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">:</span>
            <span class="n">return_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">()</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;running post_run hook&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;post_run&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">return_val</span>

    <span class="k">def</span> <span class="nf">run_forever</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tb</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function wraps ``run()`` with an endless while loop.  If any</span>
<span class="sd">        exception is encountered it will be logged and then the application</span>
<span class="sd">        will be reloaded.</span>

<span class="sd">        :param interval: The number of seconds to sleep before reloading the</span>
<span class="sd">            the appliction.</span>
<span class="sd">        :param tb: Whether or not to print traceback if exception occurs.</span>
<span class="sd">        :returns: It should never return.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">tb</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">traceback</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;inside run_forever() eternal loop&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;Caught Exception: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tb</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span>
                        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
                    <span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is useful for reloading a running applications, for</span>
<span class="sd">        example to reload configuration settings, etc.</span>

<span class="sd">        :returns: ``None``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;reloading the </span><span class="si">%s</span><span class="s1"> application&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extended_members</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extended_members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">__handlers__</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">__hooks__</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lay_cement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the application.  This runs the ``pre_close`` and ``post_close``</span>
<span class="sd">        hooks allowing plugins/extensions/etc to cleanup at the end of</span>
<span class="sd">        program execution.</span>

<span class="sd">        :param code: An exit code to exit with (``int``), if ``None`` is</span>
<span class="sd">          passed then exit with whatever ``self.exit_code`` is currently set</span>
<span class="sd">          to.  Note: ``sys.exit()`` will only be called if</span>
<span class="sd">          ``CementApp.Meta.exit_on_close==True``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pre_close&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;closing the </span><span class="si">%s</span><span class="s2"> application&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;post_close&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">,</span> \
                <span class="s2">&quot;Invalid exit status code (must be integer)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span> <span class="o">=</span> <span class="n">code</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">exit_on_close</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a simple wrapper around self.output.render() which simply</span>
<span class="sd">        returns an empty string if no self.output handler is defined.</span>

<span class="sd">        :param data: The data dictionary to render.</span>
<span class="sd">        :param template: The template to render to.  Default: None (some</span>
<span class="sd">            output handlers do not use templates).</span>
<span class="sd">        :param out: A file like object (sys.stdout, or actual file).  Set to</span>
<span class="sd">         ``None`` is no output is desired (just render and return).</span>
<span class="sd">         Default: sys.stdout</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pre_render&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;pre_render hook did not return a dict().&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">res</span>

        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;render() called, but no output handler defined.&#39;</span><span class="p">)</span>
            <span class="n">out_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;post_render&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">out_text</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;post_render hook did not return a str()&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;out&#39; must be a &#39;file&#39; like object&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">out_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;render() called but output text is None&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_text</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_rendered</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_text</span>

    <span class="k">def</span> <span class="nf">get_last_rendered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATION WARNING: This function is deprecated as of Cement 2.1.3</span>
<span class="sd">        in favor of the `self.last_rendered` property, and will be removed in</span>
<span class="sd">        future versions of Cement.</span>

<span class="sd">        Return the (data, output_text) tuple of the last time self.render()</span>
<span class="sd">        was called.</span>

<span class="sd">        :returns: tuple (data, output_text)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ignore_deprecation_warnings</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cement Deprecation Warning: &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;CementApp.get_last_rendered() has been &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;deprecated, and will be removed in future &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;versions of Cement.  You should use the &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;CementApp.last_rendered property instead.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_rendered</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_rendered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the (data, output_text) tuple of the last time self.render() was</span>
<span class="sd">        called.</span>

<span class="sd">        :returns: tuple (data, output_text)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_rendered</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the `parsed_args` object as returned by self.args.parse().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span>

    <span class="k">def</span> <span class="nf">add_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A shortcut for self.args.add_argument.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_suppress_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;not suppressing console output because of debug mode&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;suppressing all console output&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stdout__</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stderr__</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unsuppress_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;unsuppressing all console output&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stdout__</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__saved_stderr__</span>

    <span class="k">def</span> <span class="nf">_lay_cement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the framework.&quot;&quot;&quot;</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;laying cement for the &#39;</span><span class="si">%s</span><span class="s2">&#39; application&quot;</span> <span class="o">%</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;--debug&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="s1">&#39;--quiet&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_suppress_output</span><span class="p">()</span>

        <span class="c1"># Forward/Backward compat, see Issue #311</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">use_backend_globals</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">__hooks__</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">backend</span><span class="o">.</span><span class="n">__handlers__</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="n">HandlerManager</span><span class="p">(</span><span class="n">use_backend_globals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span> <span class="o">=</span> <span class="n">HookManager</span><span class="p">(</span><span class="n">use_backend_globals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="n">HandlerManager</span><span class="p">(</span><span class="n">use_backend_globals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span> <span class="o">=</span> <span class="n">HookManager</span><span class="p">(</span><span class="n">use_backend_globals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># define framework hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pre_setup&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;post_setup&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pre_run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;post_run&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pre_argument_parsing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;post_argument_parsing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pre_close&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;post_close&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;pre_render&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;post_render&#39;</span><span class="p">)</span>

        <span class="c1"># define application hooks from meta</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">define_hooks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="c1"># register some built-in framework hooks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;post_setup&#39;</span><span class="p">,</span> <span class="n">add_handler_override_options</span><span class="p">,</span>
                           <span class="n">weight</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;post_argument_parsing&#39;</span><span class="p">,</span>
                           <span class="n">handler_override</span><span class="p">,</span> <span class="n">weight</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>

        <span class="c1"># register application hooks from meta.  the hooks listed in</span>
        <span class="c1"># CementApp.Meta.hooks are registered here, so obviously can not be</span>
        <span class="c1"># for any hooks other than the builtin framework hooks that we just</span>
        <span class="c1"># defined here (above).  Anything that we couldn&#39;t register here</span>
        <span class="c1"># will be retried after setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__retry_hooks__</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">hook_spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">hooks</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">defined</span><span class="p">(</span><span class="n">hook_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;hook </span><span class="si">%s</span><span class="s1"> not defined, will retry after setup&#39;</span> <span class="o">%</span>
                          <span class="n">hook_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__retry_hooks__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook_spec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="o">*</span><span class="n">hook_spec</span><span class="p">)</span>

        <span class="c1"># define and register handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">extension</span><span class="o">.</span><span class="n">IExtension</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">ILog</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">IConfig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">IMail</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">IPlugin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">IOutput</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">IArgument</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">IController</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">ICache</span><span class="p">)</span>

        <span class="c1"># define application handlers</span>
        <span class="k">for</span> <span class="n">interface_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">define_handlers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">interface_class</span><span class="p">)</span>

        <span class="c1"># extension handler is the only thing that can&#39;t be loaded... as,</span>
        <span class="c1"># well, an extension.  ;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">extension</span><span class="o">.</span><span class="n">CementExtensionHandler</span><span class="p">)</span>

        <span class="c1"># register application handlers</span>
        <span class="k">for</span> <span class="n">handler_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">handler_class</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;pre_argument_parsing&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">arguments_override_config</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">member</span> <span class="ow">and</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># don&#39;t override config values for options that weren&#39;t passed</span>
                <span class="c1"># or in otherwords are None</span>
                <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span><span class="p">,</span> <span class="n">member</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_sections</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span>
                                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span><span class="p">,</span> <span class="n">member</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">override_arguments</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_sections</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">section</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span>
                                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_args</span><span class="p">,</span> <span class="n">member</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;post_argument_parsing&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">catch_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add ``signum`` to the list of signals to catch and handle by Cement.</span>

<span class="sd">        :param signum: The signal number to catch.  See Python ``signal``</span>
<span class="sd">          library.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;adding signal handler </span><span class="si">%s</span><span class="s2"> for signal </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">signal_handler</span><span class="p">,</span> <span class="n">signum</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">signal_handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">catch_signals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;catch_signals=None... not handling any signals&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">signum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">catch_signals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catch_signal</span><span class="p">(</span><span class="n">signum</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler_type</span><span class="p">,</span> <span class="n">handler_def</span><span class="p">,</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">meta_defaults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">handler_def</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">_meta_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">handler_type</span><span class="p">,</span> <span class="n">handler_def</span><span class="p">)</span>
            <span class="n">meta_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">meta_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_meta_label</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler_def</span><span class="p">,</span> <span class="s1">&#39;Meta&#39;</span><span class="p">):</span>
            <span class="n">_meta_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">handler_type</span><span class="p">,</span> <span class="n">handler_def</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">meta_defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">meta_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_meta_label</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">han</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">handler_type</span><span class="p">,</span> <span class="n">handler_def</span><span class="p">,</span>
                                   <span class="n">raise_error</span><span class="o">=</span><span class="n">raise_error</span><span class="p">,</span>
                                   <span class="n">meta_defaults</span><span class="o">=</span><span class="n">meta_defaults</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">han</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">han</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">han</span>

    <span class="k">def</span> <span class="nf">_setup_extension_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.extension handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;extension&#39;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">extension_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">load_extensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">core_extensions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">load_extensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">extensions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_config_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.config handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_handler</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_section</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_defaults</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_extension</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;etc&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ext</span><span class="p">)),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">HOME_DIR</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">ext</span><span class="p">)),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">HOME_DIR</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_config</span><span class="p">()</span>

        <span class="c1"># hack for --debug</span>
        <span class="k">if</span> <span class="s1">&#39;--debug&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">debug</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_section</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># override select Meta via config</span>
        <span class="n">base_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_section_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">config_section</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">base_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">core_meta_override</span> <span class="ow">or</span> \
                    <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">meta_override</span><span class="p">:</span>
                <span class="c1"># kind of a hack for core_meta_override</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">is_true</span><span class="p">(</span><span class="n">base_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">base_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># load extensions from configuraton file</span>
        <span class="k">if</span> <span class="s1">&#39;extensions&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">):</span>
            <span class="n">exts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">)</span>

            <span class="c1"># convert a comma-separated string to a list</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">exts</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">ext_list</span> <span class="o">=</span> <span class="n">exts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

                <span class="c1"># clean up extra space if they had it inbetween commas</span>
                <span class="n">ext_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ext_list</span><span class="p">]</span>

                <span class="c1"># set the new extensions value in the config</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">)</span>

            <span class="c1"># otherwise, if it&#39;s a list (ConfigObj?)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">exts</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">ext_list</span> <span class="o">=</span> <span class="n">exts</span>

            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">ext_list</span><span class="p">:</span>
                <span class="c1"># load the extension</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>

                <span class="c1"># add to meta data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_mail_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.mail handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">mail_handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_log_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.log handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">log_handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_plugin_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.plugin handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>

        <span class="c1"># plugin config dirs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_config_dirs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_config_dirs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;/etc/</span><span class="si">%s</span><span class="s1">/plugins.d/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">HOME_DIR</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;plugins.d&#39;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_config_dir</span>
        <span class="k">if</span> <span class="n">config_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_config_dirs</span><span class="p">:</span>
                <span class="c1"># append so that this config has precedence</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_config_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_dir</span><span class="p">)</span>

        <span class="c1"># plugin dirs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_dirs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_dirs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">HOME_DIR</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;plugins&#39;</span><span class="p">),</span>
                <span class="s1">&#39;/usr/lib/</span><span class="si">%s</span><span class="s1">/plugins&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="n">plugin_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_dir</span>
        <span class="k">if</span> <span class="n">plugin_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plugin_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_dirs</span><span class="p">:</span>
                <span class="c1"># insert so that this dir has precedence</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_dirs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">plugin_dir</span><span class="p">)</span>

        <span class="c1"># plugin bootstrap</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_bootstrap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_bootstrap</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.plugins&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;plugin&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugin_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugin</span><span class="o">.</span><span class="n">get_enabled_plugins</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_setup_output_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">output_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no output handler defined, skipping.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.output handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">output_handler</span><span class="p">,</span>
                                            <span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># template module</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_module</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.templates&#39;</span> <span class="o">%</span> <span class="n">label</span>

        <span class="c1"># template dirs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">HOME_DIR</span><span class="p">,</span> <span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
                <span class="s1">&#39;/usr/lib/</span><span class="si">%s</span><span class="s1">/templates&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_template_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">template_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dir</span>
        <span class="k">if</span> <span class="n">template_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">template_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="p">:</span>
                <span class="c1"># insert so that this dir has precedence</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">template_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_cache_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;no cache handler defined, skipping.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.cache handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">cache_handler</span><span class="p">,</span>
                                           <span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_arg_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up </span><span class="si">%s</span><span class="s2">.arg handler&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;argument&#39;</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">argument_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span>
                               <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                               <span class="n">help</span><span class="o">=</span><span class="s1">&#39;toggle debug output&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--quiet&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;suppress_output&#39;</span><span class="p">,</span>
                               <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                               <span class="n">help</span><span class="o">=</span><span class="s1">&#39;suppress all output&#39;</span><span class="p">)</span>

        <span class="c1"># merge handler override meta data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># fucking long names... fuck.  anyway, merge the core handler</span>
            <span class="c1"># override options with developer defined options</span>
            <span class="n">core</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">core_handler_override_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">core</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">handler_override_options</span> <span class="o">=</span> <span class="n">core</span>

    <span class="k">def</span> <span class="nf">_setup_controllers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;setting up application controllers&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cntr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">cntr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">registered</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_handler</span><span class="p">(</span><span class="s1">&#39;controller&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span>

        <span class="c1"># This is necessary for some backend usage</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">base_controller</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">FrameworkError</span><span class="p">(</span><span class="s2">&quot;Base controllers must have &quot;</span> <span class="o">+</span>
                                         <span class="s2">&quot;a label of &#39;base&#39;.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate application config settings.</span>

<span class="sd">        Usage:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            import os</span>
<span class="sd">            from cement.core import foundation</span>

<span class="sd">            class MyApp(foundation.CementApp):</span>
<span class="sd">                class Meta:</span>
<span class="sd">                    label = &#39;myapp&#39;</span>

<span class="sd">                def validate_config(self):</span>
<span class="sd">                    super(MyApp, self).validate_config()</span>

<span class="sd">                    # test that the log file directory exist, if not create it</span>
<span class="sd">                    logdir = os.path.dirname(self.config.get(&#39;log&#39;, &#39;file&#39;))</span>

<span class="sd">                    if not os.path.exists(logdir):</span>
<span class="sd">                        os.makedirs(logdir)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">add_template_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a directory path to the list of template directories to parse</span>
<span class="sd">        for templates.</span>

<span class="sd">        :param path: Directory path that contains template files.</span>

<span class="sd">        Usage:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            app.add_template_dir(&#39;/path/to/my/templates&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_template_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a directory path from the list of template directories to parse</span>
<span class="sd">        for templates.</span>

<span class="sd">        :param path: Directory path that contains template files.</span>

<span class="sd">        Usage:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            app.remove_template_dir(&#39;/path/to/my/templates&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">template_dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__import__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">from_module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># EXPERIMENTAL == UNDOCUMENTED</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">alternative_module_mapping</span>

        <span class="k">if</span> <span class="n">from_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_from</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">from_module</span><span class="p">,</span> <span class="n">from_module</span><span class="p">)</span>
            <span class="n">_loaded</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">_from</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_loaded</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="n">_loaded</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">(),</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_loaded</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
        <span class="c1"># only close the app if there are no unhandled exceptions</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">MkConfig 0.1-alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Michael Fong.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>